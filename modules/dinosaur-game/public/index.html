<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dinosaur Game</title>
    <link rel="stylesheet" href="style.css" />

    <!-- Update TensorFlow.js libraries to match main app versions -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core@4.10.0/dist/tf-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter@4.10.0/dist/tf-converter.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl@4.10.0/dist/tf-backend-webgl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@0.0.6/dist/pose-detection.min.js"></script>
  </head>

  <body>
    <h1>Dinosaur Game</h1>
    <div id="loading">Loading model and webcam...</div>
    <div id="main" style="display: none; position: relative">
      <!-- Webcam video element (hidden but used for input) -->
      <video id="webcam" playsinline style="display: none"></video>

      <!-- Mask video element (hidden, loops, plays inline) -->
      <video
        id="mask-video"
        playsinline
        loop
        muted
        autoplay
        style="display: none"
      >
        <source src="videos/walking-longneck.mp4" type="video/mp4" />
        Your browser does not support the video tag.
      </video>

      <!-- Canvas layers for drawing -->
      <div class="canvas-container">
        <button
          id="fullscreen-btn"
          class="fullscreen-button"
          title="Toggle fullscreen"
        >
          â¤¢
        </button>
        <div class="canvas-scaler">
          <!-- Base canvas for webcam and mask -->
          <canvas id="base-canvas" class="canvas-layer"></canvas>
          <!-- Silhouette layer -->
          <canvas id="silhouette-canvas" class="canvas-layer"></canvas>
          <!-- Difference layer to show overlapping areas -->
          <canvas id="difference-canvas" class="canvas-layer"></canvas>
          <!-- Skeleton layer on top -->
          <canvas id="skeleton-canvas" class="canvas-layer"></canvas>
        </div>
      </div>

      <!-- Optional: Display score -->
      <div id="score">Score: 0%</div>
    </div>

    <!-- Skeleton Controls -->
    <div id="skeleton-controls" class="control-panel">
      <h2>Skeleton Controls</h2>

      <!-- Camera controls -->
      <div class="camera-controls">
        <h3>Camera Setup</h3>
        <div class="control-group">
          <label for="camera-select">Camera:</label>
          <select id="camera-select" class="full-width-control">
            <option value="">Loading cameras...</option>
          </select>
        </div>
        <div class="control-group">
          <label for="resolution-select">Resolution:</label>
          <select id="resolution-select" class="full-width-control">
            <option value="640x480">640x480 (Default)</option>
            <option value="1280x720">1280x720 (HD)</option>
            <option value="1920x1080">1920x1080 (Full HD)</option>
            <option value="320x240">320x240 (Low)</option>
          </select>
        </div>
        <div class="control-group">
          <label for="process-resolution-select">Processing Resolution:</label>
          <select id="process-resolution-select" class="full-width-control">
            <option value="640x480">640x480 (Default - Faster)</option>
            <option value="320x240">320x240 (Low - Fastest)</option>
            <option value="960x720">960x720 (Medium)</option>
            <option value="1280x720">1280x720 (HD - Slower)</option>
          </select>
          <small
            >Lower resolution = faster processing, higher resolution = more
            accurate detection</small
          >
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="flip-webcam" />
            Flip Webcam Horizontally
          </label>
        </div>
        <div class="control-group">
          <button id="apply-camera-settings">Apply Camera Settings</button>
        </div>
      </div>

      <!-- Layer controls -->
      <div class="layer-controls">
        <h3>Layers</h3>
        <div class="control-group">
          <label>
            <input type="checkbox" id="show-webcam" />
            Show Webcam
          </label>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="show-mask-overlay" checked />
            Show Mask Overlay
          </label>
        </div>
        <div class="control-group">
          <label for="mask-opacity">Mask Opacity:</label>
          <input type="range" id="mask-opacity" min="0" max="100" value="100" />
          <span id="mask-opacity-value">100%</span>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="show-silhouette" checked />
            Show Silhouette
          </label>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="show-skeleton" />
            Show Skeleton
          </label>
        </div>
        <div class="control-group">
          <label>
            <input type="checkbox" id="show-difference" checked />
            Show Difference Layer
          </label>
        </div>
      </div>

      <!-- Skeleton style controls -->
      <div class="style-controls">
        <h3>Skeleton Style</h3>
        <div class="control-group">
          <label for="line-color">Line Color:</label>
          <input type="color" id="line-color" value="#FF0000" />
        </div>

        <div class="control-group">
          <label for="line-width">Line Width:</label>
          <input type="range" id="line-width" min="1" max="20" value="5" />
          <span id="line-width-value">5</span>
        </div>

        <div class="control-group">
          <label for="keypoint-color">Keypoint Color:</label>
          <input type="color" id="keypoint-color" value="#00FF00" />
        </div>

        <div class="control-group">
          <label for="keypoint-size">Keypoint Size:</label>
          <input type="range" id="keypoint-size" min="1" max="15" value="5" />
          <span id="keypoint-size-value">5</span>
        </div>
      </div>

      <!-- Silhouette style controls -->
      <div class="style-controls">
        <h3>Silhouette Style</h3>
        <div class="control-group">
          <label for="silhouette-color">Fill Color:</label>
          <input type="color" id="silhouette-color" value="#FFFFFF" />
        </div>

        <div class="control-group">
          <label for="silhouette-thickness">Thickness:</label>
          <input
            type="range"
            id="silhouette-thickness"
            min="5"
            max="100"
            value="50"
          />
          <span id="silhouette-thickness-value">50</span>
        </div>

        <div class="control-group">
          <label for="silhouette-opacity">Opacity:</label>
          <input
            type="range"
            id="silhouette-opacity"
            min="0"
            max="100"
            value="100"
          />
          <span id="silhouette-opacity-value">100%</span>
        </div>

        <div class="control-group">
          <label for="silhouette-pixelation">Pixelation:</label>
          <input
            type="range"
            id="silhouette-pixelation"
            min="1"
            max="50"
            value="16"
          />
          <span id="silhouette-pixelation-value">16x</span>
        </div>

        <div class="control-group">
          <label for="silhouette-head-size">Head Size:</label>
          <input
            type="range"
            id="silhouette-head-size"
            min="0.5"
            max="3.0"
            step="0.1"
            value="1.0"
          />
          <span id="silhouette-head-size-value">1.0x</span>
        </div>
      </div>

      <div class="control-group">
        <button id="reset-controls">Reset to Defaults</button>
      </div>
    </div>

    <!-- Load the application script -->
    <script src="script.js"></script>
  </body>
</html>
